(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{4930:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__N_SSG:()=>u,default:()=>d});var n=r(7876),l=r(4232);let a=e=>{let{options:t,selected:r,onChange:a,label:o}=e,[s,c]=(0,l.useState)(""),[i,u]=(0,l.useState)(!1),d=(0,l.useRef)(null),p=e=>{a(r.includes(e)?r.filter(t=>t!==e):[...r,e])},f=t.filter(e=>e.toLowerCase().includes(s.toLowerCase())),h=r.length===t.length;return(0,l.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,n.jsxs)("div",{ref:d,style:{position:"relative"},children:[o&&(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:o})}),(0,n.jsx)("input",{type:"text",value:s,onChange:e=>c(e.target.value),placeholder:"Pesquise uma op\xe7\xe3o",onFocus:()=>u(!0),style:{marginBottom:"10px",padding:"5px",width:"100%"}}),i&&(0,n.jsxs)("div",{style:{position:"absolute",top:"calc(100% + 5px)",left:0,width:"300px",backgroundColor:"#fff",border:"1px solid #ddd",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:9999,marginTop:"5px",maxHeight:"300px",overflowY:"auto",padding:"10px"},children:[(0,n.jsx)("div",{style:{marginBottom:"10px"},children:(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"checkbox",checked:h,onChange:()=>{r.length===t.length?a([]):a([...t])}})," ","Selecionar tudo"]})}),f.length>0?(0,n.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:f.map(e=>(0,n.jsx)("li",{children:(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"checkbox",value:e,checked:r.includes(e),onChange:()=>p(e)})," ",e]})},e))}):(0,n.jsx)("p",{style:{fontStyle:"italic",color:"#777"},children:"Nenhuma op\xe7\xe3o encontrada"})]})]})};var o=r(3610);let s=e=>{var t,r,a;let{width:s=700,height:c=700,geoData:i,points:u=[],onBrushSelection:d,color:p,center_by_bar:f,zoom_by_bar:h}=e,m=(0,l.useRef)(null),[g,x]=l.useState(!1),[y,b]=l.useState(!1),[v,w]=l.useState(!1),j=p||o.UMr(o.t55),k=(0,l.useRef)(null),N=(0,l.useRef)(null),S=(0,l.useRef)(()=>{}),M=(0,l.useRef)(null),C=(0,l.useRef)(!1),_=(0,l.useRef)(null),E=e=>{var t;if(e.preventDefault(),!k.current)return;let r=e.deltaY<0?1.1:.9,n=k.current.scale();k.current.scale(n*r),null===(t=S.current)||void 0===t||t.call(S)},L=e=>{C.current=!0,_.current=[e.clientX,e.clientY],e.preventDefault()},R=e=>{var t;if(!C.current||!_.current||!k.current)return;let[r,n]=_.current,l=e.clientX-r,a=e.clientY-n,o=k.current.rotate();k.current.rotate([o[0]+.25*l,o[1]-.25*a,o[2]]),_.current=[e.clientX,e.clientY],null===(t=S.current)||void 0===t||t.call(S)},B=o.Bv9().domain([0,o.T9B(u,e=>e.howMany)]).range([1,50]),z=u.map(e=>e.howMany).filter(e=>null!=e),A=null!==(t=o.jkA(z))&&void 0!==t?t:0,P=null!==(r=o.T9B(z))&&void 0!==r?r:0,T=null!==(a=o.i2o(z))&&void 0!==a?a:(A+P)/2,Y=(T+A)/2,V=(T+P)/2;return(0,l.useEffect)(()=>{b(!0);let e=o.Ltv(m.current);e.on("wheel",E),e.on("mousedown",L),e.on("mousemove",R),e.selectAll("path").remove(),e.selectAll("circle").remove();let t=o.Ltv(m.current.parentElement).append("div").style("position","absolute").style("background","rgba(0, 0, 0, 0.7)").style("color","white").style("padding","6px 10px").style("border","1px solid #999").style("border-radius","4px").style("font-size","12px").style("pointer-events","none");if(k.current=g?o.uVR().scale(Math.min(s,c)/2.2).translate([s/2,c/2]):o.WK6().scale(Math.min(s,c)/2.2).translate([s/2,c/2]),!i)return;N.current=o.zFW().projection(k.current),e.append("defs").append("clipPath").attr("id","globeClip").append("path").datum({type:"Sphere"}).attr("d",N.current);let r=e.append("g"),n=!1;S.current=()=>{let[e,n]=k.current.rotate(),a=[-e,-n],s=u.filter(e=>o.Je2([e.lng,e.lat],a)<=Math.PI/2);l.attr("d",N.current({type:"Sphere"})),r.selectAll("path.country").data(i.features).join(e=>e.append("path").attr("class","country").attr("d",N.current).attr("fill","#ffddcc").attr("stroke","#fff"),e=>e.attr("d",N.current),e=>e.remove()),r.selectAll("circle").data(s,e=>e.locID+e.comName).join(e=>e.append("circle").attr("cx",e=>k.current([e.lng,e.lat])[0]).attr("cy",e=>k.current([e.lng,e.lat])[1]).attr("r",e=>B(e.howMany)).attr("opacity",.5).attr("fill",e=>j(e.comName)).on("mouseover",(e,r)=>{t.html("<strong>".concat(r.comName,"</strong><br/>\n                   Place: ").concat(r.locName,"<br/>\n                   How many: ").concat(r.howMany)).style("opacity",1).style("visibility","visible")}).on("mousemove",e=>{let r=m.current.getBoundingClientRect();t.style("left","".concat(e.clientX-r.left+10,"px")).style("top","".concat(e.clientY-r.top-28,"px"))}).on("mouseout",()=>{t.style("opacity",0)}),e=>e.attr("cx",e=>k.current([e.lng,e.lat])[0]).attr("cy",e=>k.current([e.lng,e.lat])[1]).attr("r",e=>B(e.howMany)),e=>e.remove())},o.Ltv(window).on("mouseup",()=>{n&&(n=!1)}),o.Ltv(window).on("mouseleave",()=>{n&&(n=!1)});let l=r.append("path").datum({type:"Sphere"}).attr("fill","#aadaff");return S.current(),r.selectAll("path.country").data(i.features).enter().append("path").attr("class","country").attr("d",N.current).attr("fill","#ffddcc").attr("stroke","#fff"),M.current=o.V$7().extent([[0,0],[s,c]]).on("start",()=>{w(!0),e.on("wheel",null),e.on("mousedown",null)}).on("end",t=>{if(!t.selection){w(!1);return}if("function"!=typeof k.current.invert){console.warn("Projection does not support invert.");return}console.log("brush end",t.selection);let[[r,n],[l,a]]=t.selection,i=k.current.invert([r,n]),u=k.current.invert([l,a]);if(console.log("p0",i,"p1",u),!i||!u){console.log("Sele\xe7\xe3o fora da esfera, ignorando.");return}d&&d([[i[0],i[1]],[u[0],u[1]]]);let p=(i[0]+u[0])/2,f=(i[1]+u[1])/2,h=Math.min(s,c)/Math.max(Math.abs(l-r),Math.abs(a-n))*k.current.scale()*.5;k.current.scale(h),k.current.rotate([-p,-f]),N.current=o.zFW().projection(k.current),S.current(),e.on("wheel",E),e.on("mousedown",L),e.on("mousemove",R),w(!1)}),()=>{t.remove()}},[i,s,c,u,d,g]),(0,l.useEffect)(()=>{let e=o.Ltv(m.current);e.selectAll(".brush").remove(),v&&M.current&&e.append("g").attr("class","brush").call(M.current).raise()},[v]),(0,l.useEffect)(()=>{let e=()=>{C.current=!1,_.current=null};return window.addEventListener("mouseup",e),window.addEventListener("mouseleave",e),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("mouseleave",e)}},[]),(0,l.useEffect)(()=>{var e;if(!u.length||!k.current)return;let t=o.i2o(u,e=>e.lng),r=o.i2o(u,e=>e.lat);k.current.rotate([-t,-r]),null===(e=S.current)||void 0===e||e.call(S)},[u]),(0,l.useEffect)(()=>{if(!f||!k.current||!S.current)return;let[e,t]=f;!function(e,t,r,n,l){let a=e.rotate(),s=e.scale(),c=o.GWP(a,t),i=o.GWP(s,2e3);o.kYK().duration(1e3).tween("projection",()=>t=>{e.rotate(c(t)),e.scale(i(t)),l()})}(k.current,[-t,-e,0],0,0,S.current)},[f,h]),(0,n.jsxs)("div",{style:{position:"relative"},children:[(0,n.jsx)("svg",{ref:m,width:s,height:c,style:{cursor:"grab",backgroundColor:"#0a0a0a"}}),y&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>x(e=>!e),style:{position:"absolute",top:10,right:10,padding:"8px 12px",backgroundColor:"#4dabf7",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer"},children:g?"Voltar ao globo":"Flatten globe"}),(0,n.jsx)("button",{onClick:()=>{w(e=>!e)},style:{position:"absolute",top:50,right:10,padding:"8px 12px",backgroundColor:"#82c91e",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer"},children:v?"Desabilitar Brush":"Habilitar Brush"}),(0,n.jsxs)("div",{style:{position:"absolute",top:100,right:10,padding:"4px",backgroundColor:"#ffffffdd",borderRadius:"8px",fontSize:"12px",color:"#000",width:"170px"},children:[(0,n.jsx)("strong",{children:"How many birds:"}),[A,Y,T,V,P].some(e=>e>0)&&(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",marginTop:"6px"},children:[A,Y,T,V,P].map(e=>{if(e>0){let t=B(e);return(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[(0,n.jsxs)("span",{style:{fontSize:"11px",whiteSpace:"nowrap"},children:[Math.round(e),"   "]}),(0,n.jsx)("svg",{width:2*t,height:2*t,children:(0,n.jsx)("circle",{cx:t,cy:t,r:t,fill:"#aaa",opacity:.6,stroke:"#666"})})]},e)}return null})})]})]})]})},c=e=>{let{data:t,width:r=475,color:a,onBarClick:s}=e,c=(0,l.useRef)(null),i=12*t.length+90,u=a||o.UMr(o.t55);return(0,l.useEffect)(()=>{let e=o.Ltv(c.current);if(e.selectAll("*").remove(),!t||0===t.length)return;let n=o.Ltv("body").append("div").style("position","absolute").style("padding","6px").style("background","rgba(0, 0, 0, 0.7)").style("color","white").style("border-radius","4px").style("pointer-events","none").style("font-size","12px").style("display","none"),l={top:20,right:30,bottom:60,left:150},a=r-l.left-l.right,d=i-l.top-l.bottom,p=[...t].sort((e,t)=>o.rGT(e.howMany,t.howMany)),f=o.T9B(p,e=>e.howMany),h=o.m4Y().domain([0,o.T9B(p,e=>e.howMany)]).nice().range([0,a]),m=o.WH().domain(p.map(e=>e.locName)).range([0,d]).padding(.1),g=e.append("g").attr("transform","translate(".concat(l.left,",").concat(l.top,")"));g.append("g").call(o.V4s(m).tickFormat(e=>{let t=String(e);return t.length>15?t.slice(0,12)+"...":t}));let x=o.l78(h);if(f>100){let e=o.y17(0,f+20,20);x.tickValues(e)}if(f>200){let e=o.y17(0,f+30,30);x.tickValues(e)}if(f>300){let e=o.y17(0,f+40,40);x.tickValues(e)}if(f>400){let e=o.y17(0,f+50,50);x.tickValues(e)}g.append("g").attr("transform","translate(0,".concat(d,")")).call(x),g.selectAll("rect").data(p).enter().append("rect").attr("x",0).attr("y",e=>m(e.locName)).attr("height",m.bandwidth()).attr("width",e=>h(e.howMany)).attr("fill",e=>u(e.comName)).on("mouseover",(e,t)=>{n.style("display","block").html("\n            <strong>".concat(t.comName,"</strong><br/>\n            Place: ").concat(t.locName,"<br/>\n            How many: ").concat(t.howMany,"\n          "))}).on("mousemove",e=>{n.style("left",e.pageX+10+"px").style("top",e.pageY-28+"px")}).on("mouseout",()=>{n.style("display","none")}).on("click",(e,t)=>{s(t.lat,t.lng)}),g.append("text").attr("x",a/2).attr("y",d+35).attr("text-anchor","middle").attr("fill","white").style("font-size","12px").text("How many birds"),g.append("text").attr("transform","rotate(-90)").attr("x",-d/2).attr("y",-l.left+20).attr("text-anchor","middle").attr("fill","white").style("font-size","12px").text("Local da observa\xe7\xe3o")},[t,r,i]),(0,n.jsx)("svg",{ref:c,width:r,height:i})};var i=r(5198),u=!0;function d(e){let{global_data:t,list_visible:r}=e,[u,d]=(0,l.useState)([]),[p,f]=(0,l.useState)([]),[h,m]=(0,l.useState)(null),[g,x]=(0,l.useState)(null),[y,b]=(0,l.useState)(1),v=(0,l.useMemo)(()=>t.filter(e=>u.includes(e.comName)),[u,t]),w=o.UMr().domain(Array.from(new Set(r.map(e=>e.comName)))).range(["#e41a1c","#377eb8","#4daf4a","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#d95f02","#1b9e77","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666","#1f77b4","#ff9896","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#8c8c8c","#9b59b6","#d62728","#ff7f0e","#2ca02c"]);(0,l.useEffect)(()=>{m(i),p.length>0&&console.log("Usando dados filtrados fora do handleBrush:",p)},[p]);let j=(0,l.useCallback)(e=>{if(!e){f([]);return}let[[t,r],[n,l]]=e;console.log(e);let a=Math.min(t,n),o=Math.max(t,n),s=Math.min(r,l),c=Math.max(r,l),i=v.filter(e=>{let t=e.lng,r=e.lat;return t>=a&&t<=o&&r>=s&&r<=c});console.log(i),f(i)},[v]);return(0,n.jsxs)("div",{style:{backgroundColor:"#0a0a0a",color:"#d3d3d3"},children:[(0,n.jsxs)("div",{className:"grid grid-cols-[25%_75%] w-full",style:{alignItems:"start"},children:[(0,n.jsx)("div",{className:"bg-white-100 p-4",children:(0,n.jsx)(a,{options:r,selected:u,onChange:d,label:"Select options"})}),(0,n.jsx)("div",{className:"bg-white-100 p-4 max-h-30 overflow-auto",children:u.length>0?(0,n.jsx)("div",{className:"p-4",children:(0,n.jsx)("ul",{className:"list-none p-0 flex flex-wrap",children:u.map(e=>(0,n.jsx)("li",{className:"mb-2 mr-2",children:(0,n.jsx)("button",{onClick:()=>{d(u.filter(t=>t!==e))},style:{backgroundColor:w(e)},className:"ml-2 px-2 py-1 bg-red-500 text-white rounded hover:bg-600",children:e})},e))})}):(0,n.jsx)("p",{className:"p-4",children:"None Selected"})})]}),(0,n.jsxs)("div",{className:"grid grid-cols-[30%_70%] w-full",style:{alignItems:"start"},children:[(0,n.jsx)("div",{style:{backgroundColor:"#0a0a0a",color:"#d3d3d3"},children:(0,n.jsx)(c,{data:0===u.length?[]:p.length>0?p:v,color:w,onBarClick:(e,t)=>{x([e,t]),b(4)}})}),(0,n.jsx)("div",{style:{backgroundColor:"#0a0a0a"},children:(0,n.jsx)(s,{geoData:h,points:v,onBrushSelection:j,color:w,center_by_bar:g,zoom_by_bar:y})})]})]})}},6760:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(4930)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[610,198,636,593,792],()=>t(6760)),_N_E=e.O()}]);