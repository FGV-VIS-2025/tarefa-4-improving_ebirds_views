(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{4930:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__N_SSG:()=>d,default:()=>p});var l=r(7876),n=r(4939),a=r(4232);let o=e=>{let{options:t,selected:r,onChange:n,label:o}=e,[s,i]=(0,a.useState)(""),[c,u]=(0,a.useState)(!1),d=(0,a.useRef)(null),p=e=>{n(r.includes(e)?r.filter(t=>t!==e):[...r,e])},h=t.filter(e=>e.toLowerCase().includes(s.toLowerCase())),f=r.length===t.length;return(0,a.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,l.jsxs)("div",{ref:d,style:{position:"relative"},children:[o&&(0,l.jsx)("p",{children:(0,l.jsx)("strong",{children:o})}),(0,l.jsx)("input",{type:"text",value:s,onChange:e=>i(e.target.value),placeholder:"Search some species",onFocus:()=>u(!0),style:{marginBottom:"10px",padding:"5px",width:"100%"}}),c&&(0,l.jsxs)("div",{style:{position:"absolute",top:"calc(100% + 5px)",left:0,width:"300px",backgroundColor:"#111",border:"1px solid #333",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:9999,marginTop:"5px",maxHeight:"300px",overflowY:"auto",padding:"10px"},children:[(0,l.jsx)("div",{style:{marginBottom:"10px"},children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:f,onChange:()=>{r.length===t.length?n([]):n([...t])}})," ","Select All"]})}),h.length>0?(0,l.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:h.map(e=>(0,l.jsx)("li",{children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",value:e,checked:r.includes(e),onChange:()=>p(e)})," ",e]})},e))}):(0,l.jsx)("p",{style:{fontStyle:"italic",color:"#777"},children:"No options found "})]})]})};var s=r(1129);let i=e=>{var t,r,n;let{width:o=830,height:i=520,geoData:c,points:u=[],onBrushSelection:d,color:p,center_by_bar:h,zoom_by_bar:f}=e,m=(0,a.useRef)(null),[g,x]=a.useState(!1),[y,v]=a.useState(!1),[b,w]=a.useState(!1),[j,k]=a.useState(null),[N,S]=(0,a.useState)(0),M=p||s.UMr(s.t55),C=(0,a.useRef)(null),E=(0,a.useRef)(null),L=(0,a.useRef)(()=>{}),_=(0,a.useRef)(null),A=(0,a.useRef)(!1),V=(0,a.useRef)(null),z=e=>{var t;if(e.preventDefault(),!C.current)return;let r=e.deltaY<0?1.1:.9,l=C.current.scale();C.current.scale(l*r),null===(t=L.current)||void 0===t||t.call(L)},R=e=>{A.current=!0,V.current=[e.clientX,e.clientY],e.preventDefault()},B=e=>{var t;if(!A.current||!V.current||!C.current)return;let[r,l]=V.current,n=e.clientX-r,a=e.clientY-l,o=C.current.rotate();C.current.rotate([o[0]+.25*n,o[1]-.25*a,o[2]]),V.current=[e.clientX,e.clientY],null===(t=L.current)||void 0===t||t.call(L)},P=s.Bv9().domain([0,s.T9B(u,e=>e.howMany)]).range([1,50]),T=u.map(e=>e.howMany).filter(e=>null!=e),Y=null!==(t=s.jkA(T))&&void 0!==t?t:0,F=null!==(r=s.T9B(T))&&void 0!==r?r:0,X=null!==(n=s.i2o(T))&&void 0!==n?n:(Y+F)/2,H=(X+Y)/2,I=(X+F)/2;return(0,a.useEffect)(()=>{v(!0);let e=s.Ltv(m.current);e.on("wheel",z),e.on("mousedown",R),e.on("mousemove",B),e.selectAll("path").remove(),e.selectAll("circle").remove();let t=s.Ltv(m.current.parentElement).append("div").style("position","absolute").style("background","rgba(0, 0, 0, 0.7)").style("color","white").style("padding","6px 10px").style("border","1px solid #999").style("border-radius","4px").style("font-size","12px").style("pointer-events","none");if(C.current=g?s.uVR().scale(Math.min(o,i)/2.2).translate([o/2,i/2]):s.WK6().scale(Math.min(o,i)/2.2).translate([o/2,i/2]),!c)return;E.current=s.zFW().projection(C.current),e.append("defs").append("clipPath").attr("id","globeClip").append("path").datum({type:"Sphere"}).attr("d",E.current);let r=e.append("g");e.append("path").attr("id","brush-polygon").attr("fill","rgba(88, 88, 72, 0.2)").attr("stroke","orange").attr("stroke-width",2);let l=!1;L.current=()=>{let[e,l]=C.current.rotate(),a=[-e,-l],o=u.filter(e=>s.Je2([e.lng,e.lat],a)<=Math.PI/2);n.attr("d",E.current({type:"Sphere"})),r.selectAll("path.country").data(c.features).join(e=>e.append("path").attr("class","country").attr("d",E.current).attr("fill","#ffddcc").attr("stroke","#fff"),e=>e.attr("d",E.current),e=>e.remove()),r.selectAll("circle").data(o,e=>e.locID+e.comName).join(e=>e.append("circle").attr("cx",e=>C.current([e.lng,e.lat])[0]).attr("cy",e=>C.current([e.lng,e.lat])[1]).attr("r",e=>P(e.howMany)).attr("opacity",.7).attr("fill",e=>M(e.comName)).on("mouseover",(e,r)=>{t.html("<strong>".concat(r.comName,"</strong><br/>\n                   Place: ").concat(r.locName,"<br/>\n                   How many: ").concat(r.howMany)).style("opacity",1).style("visibility","visible")}).on("mousemove",e=>{let r=m.current.getBoundingClientRect();t.style("left","".concat(e.clientX-r.left+10,"px")).style("top","".concat(e.clientY-r.top-28,"px"))}).on("mouseout",()=>{t.style("opacity",0)}),e=>e.attr("cx",e=>C.current([e.lng,e.lat])[0]).attr("cy",e=>C.current([e.lng,e.lat])[1]).attr("r",e=>P(e.howMany)),e=>e.remove()),S(e=>e+1)},s.Ltv(window).on("mouseup",()=>{l&&(l=!1)}),s.Ltv(window).on("mouseleave",()=>{l&&(l=!1)});let n=r.append("path").datum({type:"Sphere"}).attr("fill","#aadaff");return L.current(),r.selectAll("path.country").data(c.features).enter().append("path").attr("class","country").attr("d",E.current).attr("fill","#ffddcc").attr("stroke","#fff"),_.current=s.V$7().extent([[0,0],[o,i]]).on("start",()=>{w(!0),e.on("wheel",null),e.on("mousedown",null)}).on("brush",e=>{let t=e.selection;if(!t)return;let[[r,l],[n,a]]=t;if("function"!=typeof C.current.invert){console.warn("Projection does not support invert.");return}let o=C.current.invert([r,l]),s=C.current.invert([n,a]);if(!o||!s)return;let i=Math.min(o[0],s[0]),c=Math.max(o[0],s[0]),u=Math.min(o[1],s[1]),d=Math.max(o[1],s[1]);k({type:"Feature",geometry:{type:"Polygon",coordinates:[[[i,u],[i,d],[c,d],[c,u],[i,u]]]},properties:{}})}).on("end",t=>{if(!t.selection){w(!1);return}if("function"!=typeof C.current.invert){console.warn("Projection does not support invert.");return}console.log("brush end",t.selection);let[[r,l],[n,a]]=t.selection,c=C.current.invert([r,l]),u=C.current.invert([n,a]);if(console.log("p0",c,"p1",u),!c||!u){console.log("Sele\xe7\xe3o fora da esfera, ignorando.");return}d&&d([[c[0],c[1]],[u[0],u[1]]]);let p=(c[0]+u[0])/2,h=(c[1]+u[1])/2,f=Math.min(o,i)/Math.max(Math.abs(n-r),Math.abs(a-l))*C.current.scale()*.5;C.current.scale(f),C.current.rotate([-p,-h]),E.current=s.zFW().projection(C.current),L.current(),e.on("wheel",z),e.on("mousedown",R),e.on("mousemove",B),w(!1)}),()=>{t.remove()}},[c,o,i,u,d,g]),(0,a.useEffect)(()=>{let e=s.Ltv(m.current);e.selectAll(".brush").remove(),b&&_.current&&(e.append("g").attr("class","brush").call(_.current),s.Ltv(m.current).select(".brush").call(_.current).selectAll("rect").style("opacity",0).raise())},[b]),(0,a.useEffect)(()=>{j&&E.current&&s.Ltv("#brush-polygon").attr("d",E.current(j)).attr("stroke","rgba(0, 0, 0, 0.2)").attr("fill","rgba(75, 75, 75, 0.2)")},[j,N]),(0,a.useEffect)(()=>{let e=()=>{A.current=!1,V.current=null};return window.addEventListener("mouseup",e),window.addEventListener("mouseleave",e),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("mouseleave",e)}},[]),(0,a.useEffect)(()=>{var e;if(!u.length||!C.current)return;let t=s.i2o(u,e=>e.lng),r=s.i2o(u,e=>e.lat);C.current.rotate([-t,-r]),null===(e=L.current)||void 0===e||e.call(L)},[u]),(0,a.useEffect)(()=>{if(!h||!C.current||!L.current)return;let[e,t]=h;!function(e,t,r,l,n){let a=e.rotate(),o=e.scale(),i=s.GWP(a,t),c=s.GWP(o,2e3);s.kYK().duration(1e3).tween("projection",()=>t=>{e.rotate(i(t)),e.scale(c(t)),n()})}(C.current,[-t,-e,0],0,0,L.current)},[h,f]),(0,l.jsxs)("div",{style:{position:"relative"},className:"ml-6 mt-6",children:[(0,l.jsx)("svg",{ref:m,width:o,height:i,style:{cursor:"grab",backgroundColor:"#0a0a0a"}}),y&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{onClick:()=>x(e=>!e),style:{width:"200px",height:"40px",position:"absolute",top:10,right:10,padding:"8px 12px",border:"none",cursor:"pointer"},children:g?(0,l.jsx)("img",{src:"/returnglobe.png",alt:"retunr globe"}):(0,l.jsx)("img",{src:"/flatemglobe.png",alt:"flatem globe"})}),(0,l.jsx)("button",{onClick:()=>{w(e=>!e)},style:{width:"200px",height:"40px",position:"absolute",top:50,right:10,padding:"8px 12px",border:"none",cursor:"pointer"},children:b?(0,l.jsx)("img",{src:"/cancelselect.png",alt:"Cancelar Filtro"}):(0,l.jsx)("img",{src:"/selectarea.png",alt:"Ativar Filtro"})}),(0,l.jsx)("button",{onClick:()=>{k(null),w(!1),null==d||d(null),s.Ltv("#brush-polygon").attr("d",null)},style:{width:"200px",height:"40px",position:"absolute",top:90,right:10,padding:"6px 12px",border:"none",cursor:"pointer"},children:j?(0,l.jsx)("img",{src:"/clearon.png",alt:"climpar ativado"}):(0,l.jsx)("img",{src:"/clearoff.png",alt:"limbar escondido"})}),(0,l.jsxs)("div",{style:{position:"absolute",top:150,right:10,padding:"4px",backgroundColor:"#ffffffdd",borderRadius:"8px",fontSize:"12px",color:"#000",width:"170px"},children:[(0,l.jsx)("strong",{children:"How many birds:"}),[Y,H,X,I,F].some(e=>e>0)&&(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",marginTop:"6px"},children:[Y,H,X,I,F].map(e=>{if(e>0){let t=P(e);return(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[(0,l.jsxs)("span",{style:{fontSize:"11px",whiteSpace:"nowrap"},children:[Math.round(e),"   "]}),(0,l.jsx)("svg",{width:2*t,height:2*t,children:(0,l.jsx)("circle",{cx:t,cy:t,r:t,fill:"#aaa",opacity:.6,stroke:"#666"})})]},e)}return null})})]})]})]})},c=e=>{let{data:t,width:r=461,color:n,onBarClick:o}=e,i=(0,a.useRef)(null),c=12*t.length+90,u=n||s.UMr(s.t55);return(0,a.useEffect)(()=>{let e=s.Ltv(i.current);if(e.selectAll("*").remove(),!t||0===t.length)return;let l=s.Ltv("body").append("div").style("position","absolute").style("padding","6px").style("background","rgba(0, 0, 0, 0.7)").style("color","white").style("border-radius","4px").style("pointer-events","none").style("font-size","12px").style("display","none"),n={top:40,right:30,bottom:60,left:150},a=r-n.left-n.right,d=c-n.top-n.bottom;e.append("text").attr("x",a/2).attr("y",n.top/2).attr("text-anchor","middle").attr("fill","white").style("font-size","16px").style("font-weight","bold").text("Places with most sightings");let p=[...t].sort((e,t)=>s.rGT(e.howMany,t.howMany));Array.from(new Set(p.map(e=>e.locName)));let h=Array.from(s.Os0(p,e=>e.locName),e=>{let[t,r]=e;return{group:t,values:r}}),f=s.TNc(p,e=>e.locName).map(e=>{let[t,r]=e;return{group:t,values:r,total:s.czq(r,e=>e.howMany)}});f.sort((e,t)=>s.rGT(e.total,t.total));let m=s.T9B(p,e=>e.howMany),g=s.m4Y().domain([0,s.T9B(p,e=>e.howMany)]).nice().range([0,a]),x=s.WH().domain(f.map(e=>e.group)).range([0,d]).padding(.1),y=e.append("g").attr("transform","translate(".concat(n.left,",").concat(n.top,")"));y.append("g").call(s.V4s(x).tickFormat(e=>{let t=String(e);return t.length>15?t.slice(0,12)+"...":t}));let v=s.l78(g);if(m>100){let e=s.y17(0,m+20,20);v.tickValues(e)}if(m>200){let e=s.y17(0,m+30,30);v.tickValues(e)}if(m>300){let e=s.y17(0,m+40,40);v.tickValues(e)}if(m>400){let e=s.y17(0,m+50,50);v.tickValues(e)}if(m>500){let e=s.y17(0,m+100,100);v.tickValues(e)}if(m>1e3){let e=s.y17(0,m+200,200);v.tickValues(e)}if(m>2e3){let e=s.y17(0,m+300,300);v.tickValues(e)}if(m>3e3){let e=s.y17(0,m+400,400);v.tickValues(e)}if(m>4e3){let e=s.y17(0,m+500,500);v.tickValues(e)}if(m>5e3){let e=s.y17(0,m+1e3,1e3);v.tickValues(e)}if(m>1e4){let e=s.y17(0,m+2e3,2e3);v.tickValues(e)}y.append("g").attr("transform","translate(0,".concat(d,")")).call(v),y.selectAll("g.layer").data(h).join("g").attr("transform",e=>"translate(0,".concat(x(e.group),")")).each(function(e){let t=s.Ltv(this),r=e.values.map(e=>e.comName),n=s.WH().domain(r).range([0,x.bandwidth()]).padding(.05);t.selectAll("rect").data(e=>e.values).join("rect").attr("y",e=>n(e.comName)).attr("x",0).attr("height",n.bandwidth()).attr("width",e=>g(e.howMany)).attr("fill",e=>u(e.comName)).on("mouseover",(e,t)=>{l.style("display","block").html("\n              <strong>".concat(t.comName,"</strong><br/>\n              Local: ").concat(t.locName,"<br/>\n              Quantidade: ").concat(t.howMany,"\n            "))}).on("mousemove",e=>{l.style("left",e.pageX+10+"px").style("top",e.pageY-28+"px")}).on("mouseout",()=>l.style("display","none")).on("click",(e,t)=>{null==o||o(t.lat,t.lng)})}),y.append("text").attr("x",a/2).attr("y",d+35).attr("text-anchor","middle").attr("fill","white").style("font-size","12px").text("How many birds"),y.append("text").attr("transform","rotate(-90)").attr("x",-d/2).attr("y",-n.left+20).attr("text-anchor","middle").attr("fill","white").style("font-size","12px").text("Local da observa\xe7\xe3o")},[t,r,c]),(0,l.jsx)("div",{style:{height:540,overflowY:"auto",overflowX:"hidden"},className:"mt-6",children:(0,l.jsx)("svg",{ref:i,width:r,height:c})})};var u=r(5198),d=!0;function p(e){let{global_data:t,list_visible:r}=e,[d,p]=(0,a.useState)([]),[h,f]=(0,a.useState)([]),[m,g]=(0,a.useState)(null),[x,y]=(0,a.useState)(null),[v,b]=(0,a.useState)(1),w=(0,a.useMemo)(()=>t.filter(e=>d.includes(e.comName)),[d,t]),j=s.UMr().domain(Array.from(new Set(r.map(e=>e.comName)))).range(["#e41a1c","#377eb8","#4daf4a","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#d95f02","#1b9e77","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666","#1f77b4","#ff9896","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#8c8c8c","#9b59b6","#d62728","#ff7f0e","#2ca02c"]);(0,a.useEffect)(()=>{g(u),h.length>0&&console.log("Usando dados filtrados fora do handleBrush:",h)},[h]);let k=(0,a.useCallback)(e=>{if(!e){f([]);return}let[[t,r],[l,n]]=e;console.log(e);let a=Math.min(t,l),o=Math.max(t,l),s=Math.min(r,n),i=Math.max(r,n),c=w.filter(e=>{let t=e.lng,r=e.lat;return t>=a&&t<=o&&r>=s&&r<=i});console.log(c),f(c)},[w]);return(0,l.jsxs)("div",{style:{backgroundColor:"#0a0a0a",color:"#d3d3d3"},children:[(0,l.jsx)(n.A,{}),(0,l.jsxs)("div",{className:"grid grid-cols-[25%_75%] w-full",style:{alignItems:"start"},children:[(0,l.jsx)("div",{className:"bg-white-100 p-4",children:(0,l.jsx)(o,{options:r,selected:d,onChange:p,label:"Select options"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"ml-8 text-2xl font-bold text-white",children:(0,l.jsx)("h1",{children:"Species:"})}),(0,l.jsx)("div",{className:"bg-white-100 p-4 max-h-20 overflow-auto",children:d.length>0?(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)("ul",{className:"list-none p-0 flex flex-wrap",children:d.map(e=>(0,l.jsx)("li",{className:"mb-px mr-1",children:(0,l.jsx)("button",{onClick:()=>{p(d.filter(t=>t!==e))},style:{backgroundColor:j(e),width:"200px",height:"20",padding:"2px 4px",lineHeight:"20px",fontSize:"13px"},className:"ml-1 text-white",children:e})},e))})}):(0,l.jsx)("p",{className:"p-4",children:"None Selected"})})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-[30%_70%] w-full",style:{alignItems:"start"},children:[(0,l.jsx)("div",{style:{backgroundColor:"#0a0a0a",color:"#d3d3d3"},children:(0,l.jsx)(c,{data:0===d.length?[]:h.length>0?h:w,color:j,onBarClick:(e,t)=>{y([e,t]),b(4)}})}),(0,l.jsx)("div",{style:{backgroundColor:"#0a0a0a"},children:(0,l.jsx)(i,{geoData:m,points:w,onBrushSelection:k,color:j,center_by_bar:x,zoom_by_bar:v})})]})]})}},6760:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(4930)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[230,129,244,636,593,792],()=>t(6760)),_N_E=e.O()}]);